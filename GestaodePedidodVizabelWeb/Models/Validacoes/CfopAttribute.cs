using System.ComponentModel.DataAnnotations;
using System.Text.RegularExpressions;

namespace GestaoPedidosVizabel.Models.Validacoes
{
    public class CfopAttribute : ValidationAttribute
    {
        // CFOPs válidos mais comuns (pode ser expandido)
        private static readonly HashSet<string> CfopsValidos = new HashSet<string>
        {
            "1101", "1102", "1201", "1202", "1301", "1302", "1401", "1402", "1403", "1404",
            "1405", "1406", "1407", "1408", "1409", "1410", "1411", "1414", "1415", "1501",
            "1502", "1503", "1504", "1505", "1506", "1507", "1508", "1509", "1510", "1511",
            "1512", "1513", "1514", "1515", "1516", "1517", "1518", "1519", "1520", "1521",
            "1522", "1523", "1524", "1551", "1552", "1553", "1554", "1555", "1556", "1557",
            "2101", "2102", "2201", "2202", "2301", "2302", "2401", "2402", "2403", "2501",
            "2502", "2503", "2504", "2505", "2551", "2552", "2553", "2554", "2555", "2556",
            "3101", "3102", "3201", "3202", "3301", "3302", "3401", "3402", "3403", "3501",
            "3502", "3503", "3504", "3505", "3551", "3552", "3553", "3554", "3555", "3556",
            "5101", "5102", "5103", "5104", "5105", "5106", "5109", "5110", "5111", "5112",
            "5113", "5114", "5115", "5116", "5117", "5118", "5119", "5120", "5122", "5123",
            "5124", "5125", "5151", "5152", "5153", "5154", "5155", "5156", "5157", "5158",
            "5159", "5160", "5161", "5162", "5201", "5202", "5203", "5204", "5205", "5206",
            "5207", "5208", "5209", "5210", "5251", "5252", "5253", "5254", "5255", "5256",
            "5257", "5258", "5301", "5302", "5303", "5304", "5305", "5306", "5307", "5308",
            "5309", "5310", "5311", "5312", "5313", "5314", "5315", "5316", "5317", "5318",
            "5319", "5320", "5321", "5322", "5323", "5324", "5351", "5352", "5353", "5354",
            "5355", "5356", "5357", "5358", "5359", "5360", "5401", "5402", "5403", "5405",
            "5551", "5552", "5553", "5554", "5555", "5556", "5557", "5601", "5602", "5603",
            "5604", "5605", "5606", "5651", "5652", "5653", "5654", "5655", "5656", "5657",
            "5658", "5659", "5660", "5661", "5662", "5663", "5901", "5902", "5903", "5904",
            "5905", "5906", "5907", "5908", "5909", "5910", "5911", "5912", "5913", "5914",
            "5915", "5916", "5917", "5918", "5919", "5920", "5921", "5922", "5923", "5924",
            "5925", "5926", "5927", "5928", "5929", "5930", "5931", "5932", "5933", "5934",
            "5935", "5936", "5937", "5938", "5939", "5940", "5941", "5942", "5943", "5944",
            "5945", "5946", "5947", "5948", "5949", "5950", "5951", "5952", "5953", "5954",
            "5955", "5956", "5957", "5958", "5959", "5960", "5961", "5962", "5963", "5964",
            "5965", "5966", "5967", "5968", "5969", "5970", "5971", "5972", "5973", "5974",
            "5975", "5976", "5977", "5978", "5979", "5980", "5981", "5982", "5983", "5984",
            "5985", "5986", "5987", "5988", "5989", "5990", "5991", "5992", "5993", "5994",
            "5995", "5996", "5997", "5998", "5999", "6101", "6102", "6103", "6104", "6105",
            "6106", "6107", "6108", "6109", "6110", "6111", "6112", "6113", "6114", "6115",
            "6116", "6117", "6118", "6119", "6120", "6121", "6122", "6123", "6124", "6125",
            "6126", "6127", "6128", "6129", "6130", "6131", "6132", "6133", "6134", "6135",
            "6136", "6137", "6138", "6139", "6140", "6141", "6142", "6143", "6144", "6145",
            "6146", "6147", "6148", "6149", "6150", "6151", "6152", "6153", "6154", "6155",
            "6156", "6157", "6158", "6159", "6160", "6161", "6162", "6163", "6164", "6165",
            "6166", "6167", "6168", "6169", "6170", "6171", "6172", "6173", "6174", "6175",
            "6176", "6177", "6178", "6179", "6180", "6181", "6182", "6183", "6184", "6185",
            "6186", "6187", "6188", "6189", "6190", "6191", "6192", "6193", "6194", "6195",
            "6196", "6197", "6198", "6199", "6201", "6202", "6203", "6204", "6205", "6206",
            "6207", "6208", "6209", "6210", "6211", "6212", "6213", "6214", "6215", "6216",
            "6217", "6218", "6219", "6220", "6221", "6222", "6223", "6224", "6225", "6226",
            "6227", "6228", "6229", "6230", "6231", "6232", "6233", "6234", "6235", "6236",
            "6237", "6238", "6239", "6240", "6241", "6242", "6243", "6244", "6245", "6246",
            "6247", "6248", "6249", "6250", "6251", "6252", "6253", "6254", "6255", "6256",
            "6257", "6258", "6259", "6260", "6261", "6262", "6263", "6264", "6265", "6266",
            "6267", "6268", "6269", "6270", "6271", "6272", "6273", "6274", "6275", "6276",
            "6277", "6278", "6279", "6280", "6281", "6282", "6283", "6284", "6285", "6286",
            "6287", "6288", "6289", "6290", "6291", "6292", "6293", "6294", "6295", "6296",
            "6297", "6298", "6299", "7101", "7102", "7105", "7106", "7107", "7108", "7109",
            "7110", "7111", "7112", "7113", "7114", "7115", "7116", "7117", "7118", "7119",
            "7120", "7121", "7122", "7123", "7124", "7125", "7126", "7127", "7128", "7129",
            "7130", "7131", "7132", "7133", "7134", "7135", "7136", "7137", "7138", "7139",
            "7140", "7141", "7142", "7143", "7144", "7145", "7146", "7147", "7148", "7149",
            "7150", "7151", "7152", "7153", "7154", "7155", "7156", "7157", "7158", "7159",
            "7160", "7161", "7162", "7163", "7164", "7165", "7166", "7167", "7168", "7169",
            "7170", "7171", "7172", "7173", "7174", "7175", "7176", "7177", "7178", "7179",
            "7180", "7181", "7182", "7183", "7184", "7185", "7186", "7187", "7188", "7189",
            "7190", "7191", "7192", "7193", "7194", "7195", "7196", "7197", "7198", "7199"
        };

        protected override ValidationResult? IsValid(object? value, ValidationContext validationContext)
        {
            if (value == null || string.IsNullOrWhiteSpace(value.ToString()))
            {
                return new ValidationResult("O campo CFOP é obrigatório.");
            }

            var cfop = value.ToString()!;

            // CFOP deve ter exatamente 4 dígitos numéricos
            if (!Regex.IsMatch(cfop, @"^\d{4}$"))
            {
                return new ValidationResult("O CFOP deve conter exatamente 4 dígitos numéricos.");
            }

            // Validar se o CFOP está na lista de CFOPs válidos
            if (!CfopsValidos.Contains(cfop))
            {
                return new ValidationResult($"O CFOP {cfop} não é um código válido para operações fiscais.");
            }

            return ValidationResult.Success;
        }
    }
}









